#!/bin/bash
#SBATCH --qos=debug
#SBATCH --nodes=2
#SBATCH --time=5:00
#SBATCH --licenses=cscratch1
#SBATCH --constraint=haswell

#set necessary env
export DSPACES_DEBUG=1
export DSPACES_NUM_HANDLERS=4

# remove unnecessary things
rm dspaces_drc.config conf.ds

# cp configure file
cp ~/cworkspace/src/dspaces/examples/execute/dataspaces.conf .

# start the server
srun -C haswell -l -N 1 -n 4 ./bin/dsserver_drc gni &> dsserver_drc.log &

while [ ! -f conf.ds ]
do
  sleep 1 
done

# start the client for testing
srun -C haswell -l -N 1 -n 16 ./bin/dsclient_drc 64 64 &> dsclient_drc.log &

wait
